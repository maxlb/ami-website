var listePays = {
  "Afrique du Sud": null,
  "Algérie": null,
  "Angola": null,
  "Bénin": null,
  "Botswana": null,
  "Burkina": null,
  "Burundi": null,
  "Cameroun": null,
  "Cap-Vert": null,
  "République centrafricaine": null,
  "Comores": null,
  "Congo": null,
  "République démocratique du Congo": null,
  "Côte d'Ivoire": null,
  "Djibouti": null,
  "Égypte": null,
  "Érythrée": null,
  "Éthiopie": null,
  "Gabon": null,
  "Gambie": null,
  "Ghana": null,
  "Guinée": null,
  "Guinée-Bissau": null,
  "Guinée équatoriale": null,
  "Kenya": null,
  "Lesotho": null,
  "Libéria": null,
  "Libye": null,
  "Madagascar": null,
  "Malawi": null,
  "Mali": null,
  "Maroc": null,
  "Maurice": null,
  "Mauritanie": null,
  "Mozambique": null,
  "Namibie": null,
  "Niger": null,
  "Nigeria": null,
  "Ouganda": null,
  "Rwanda": null,
  "Sao Tomé-et-Principe": null,
  "Sénégal": null,
  "Seychelles": null,
  "Sierra Leone": null,
  "Somalie": null,
  "Soudan": null,
  "Sud-Soudan": null,
  "Swaziland": null,
  "Tanzanie": null,
  "Tchad": null,
  "Togo": null,
  "Tunisie": null,
  "Zambie": null,
  "Zimbabwe": null,
  "Antigua-et-Barbuda": null,
  "Argentine": null,
  "Bahamas": null,
  "Barbade": null,
  "Belize": null,
  "Bolivie": null,
  "Brésil": null,
  "Canada": null,
  "Chili": null,
  "Colombie": null,
  "Costa Rica": null,
  "Cuba": null,
  "République dominicaine": null,
  "Dominique": null,
  "Équateur": null,
  "États-Unis": null,
  "Grenade": null,
  "Guatemala": null,
  "Guyana": null,
  "Haïti": null,
  "Honduras": null,
  "Jamaïque": null,
  "Mexique": null,
  "Nicaragua": null,
  "Panama": null,
  "Paraguay": null,
  "Pérou": null,
  "Porto Rico": null,
  "Saint-Christophe-et-Niévès": null,
  "Sainte-Lucie": null,
  "Saint-Vincent-et-les Grenadines": null,
  "Salvador": null,
  "Suriname": null,
  "Trinité-et-Tobago": null,
  "Uruguay": null,
  "Venezuela": null,
  "Afghanistan": null,
  "Arabie saoudite": null,
  "Bahreïn": null,
  "Bangladesh": null,
  "Bhoutan": null,
  "Birmanie": null,
  "Brunei": null,
  "Cambodge": null,
  "Chine": null,
  "Corée du Nord": null,
  "Corée du Sud": null,
  "Émirats arabes unis": null,
  "Inde": null,
  "Indonésie": null,
  "Irak": null,
  "Iran": null,
  "Israël": null,
  "Japon": null,
  "Jordanie": null,
  "Kazakhstan": null,
  "Kirghizistan": null,
  "Koweït": null,
  "Laos": null,
  "Liban": null,
  "Malaisie": null,
  "Maldives": null,
  "Mongolie": null,
  "Népal": null,
  "Oman": null,
  "Ouzbékistan": null,
  "Palestine": null,
  "Pakistan": null,
  "Philippines": null,
  "Qatar": null,
  "Singapour": null,
  "Sri Lanka": null,
  "Syrie": null,
  "Tadjikistan": null,
  "Taïwan": null,
  "Thaïlande": null,
  "Timor oriental": null,
  "Turkménistan": null,
  "Turquie": null,
  "Viêt Nam": null,
  "Yémen": null,
  "Allemagne": null,
  "Albanie": null,
  "Andorre": null,
  "Arménie": null,
  "Autriche": null,
  "Azerbaïdjan": null,
  "Belgique": null,
  "Biélorussie": null,
  "Bosnie-Herzégovine": null,
  "Bulgarie": null,
  "Chypre": null,
  "Croatie": null,
  "Danemark": null,
  "Espagne": null,
  "Estonie": null,
  "Finlande": null,
  "France": null,
  "Géorgie": null,
  "Grèce": null,
  "Hongrie": null,
  "Irlande": null,
  "Islande": null,
  "Italie": null,
  "Lettonie": null,
  "Liechtenstein": null,
  "Lituanie": null,
  "Luxembourg": null,
  "République de Macédoine": null,
  "Malte": null,
  "Moldavie": null,
  "Monaco": null,
  "Monténégro": null,
  "Norvège": null,
  "Pays-Bas": null,
  "Pologne": null,
  "Portugal": null,
  "République tchèque": null,
  "Roumanie": null,
  "Royaume-Uni": null,
  "Russie": null,
  "Saint-Marin": null,
  "Serbie": null,
  "Slovaquie": null,
  "Slovénie": null,
  "Suède": null,
  "Suisse": null,
  "Ukraine": null,
  "Vatican": null,
  "Australie": null,
  "Fidji": null,
  "Kiribati": null,
  "Marshall": null,
  "Micronésie": null,
  "Nauru": null,
  "Nouvelle-Zélande": null,
  "Palaos": null,
  "Papouasie-Nouvelle-Guinée": null,
  "Salomon": null,
  "Samoa": null,
  "Tonga": null,
  "Tuvalu": null,
  "Vanuatu": null
}

var listePaysEU = {
  "Allemagne": null,
  "Albanie": null,
  "Andorre": null,
  "Arménie": null,
  "Autriche": null,
  "Azerbaïdjan": null,
  "Belgique": null,
  "Biélorussie": null,
  "Bosnie-Herzégovine": null,
  "Bulgarie": null,
  "Chypre": null,
  "Croatie": null,
  "Danemark": null,
  "Espagne": null,
  "Estonie": null,
  "Finlande": null,
  "France": null,
  "Géorgie": null,
  "Grèce": null,
  "Hongrie": null,
  "Irlande": null,
  "Islande": null,
  "Italie": null,
  "Lettonie": null,
  "Liechtenstein": null,
  "Lituanie": null,
  "Luxembourg": null,
  "République de Macédoine": null,
  "Malte": null,
  "Moldavie": null,
  "Monaco": null,
  "Monténégro": null,
  "Norvège": null,
  "Pays-Bas": null,
  "Pologne": null,
  "Portugal": null,
  "République tchèque": null,
  "Roumanie": null,
  "Royaume-Uni": null,
  "Russie": null,
  "Saint-Marin": null,
  "Serbie": null,
  "Slovaquie": null,
  "Slovénie": null,
  "Suède": null,
  "Suisse": null,
  "Ukraine": null,
  "Vatican": null
}

var listeNationalites = {
  "Afghane": null,
  "Sud-Africaine": null,
  "Albanaise": null,
  "Algérienne": null,
  "Allemande": null,
  "Andorrane": null,
  "Angolaise": null,
  "Antiguaise et Barbudienne": null,
  "Saoudienne": null,
  "Argentine": null,
  "Arménienne": null,
  "Australienne": null,
  "Autrichienne": null,
  "Azerbaïdjanaise": null,
  "Bahreïnienne": null,
  "Bangladaise": null,
  "Barbadienne": null,
  "Belge": null,
  "Bélizienne": null,
  "Béninoise": null,
  "Bhoutanaise": null,
  "Biélorusse": null,
  "Birmane": null,
  "Bolivienne": null,
  "Bosniaque": null,
  "Botswanéenne": null,
  "Brésilienne": null,
  "Brunéienne": null,
  "Bulgare": null,
  "Burkinabè": null,
  "Burundais": null,
  "Cambodgiennes": null,
  "Camerounaise": null,
  "Canadienne": null,
  "Cap-Verdienne": null,
  "Centrafricaine": null,
  "Chilienne": null,
  "Chinoise": null,
  "Chypriote": null,
  "Colombienne": null,
  "Comorienne": null,
  "Congolaise": null,
  "Sud-Coréenne": null,
  "Nord-Coréenne": null,
  "Costaricaine": null,
  "Ivoirienne": null,
  "Croate": null,
  "Cubaine": null,
  "Danoise": null,
  "Djiboutienne": null,
  "Dominicaine": null,
  "Dominiquaise": null,
  "Egyptienne": null,
  "Emirienne": null,
  "Equatorienne": null,
  "Erythréenne": null,
  "Espagnole": null,
  "Estonienne": null,
  "Américaine": null,
  "Éthiopienne": null,
  "Fidjienne": null,
  "Finlandaise": null,
  "Française": null,
  "Gabonaise": null,
  "Gambienne": null,
  "Géorgienne": null,
  "Ghanéenne": null,
  "Grecque": null,
  "Grenadienne": null,
  "Guatémaltèque": null,
  "Guinéenne": null,
  "Bissao-Guinéenne": null,
  "Equato-Guinéenne": null,
  "Guyanienne": null,
  "Haïtienne": null,
  "Hondurienne": null,
  "Hongroise": null,
  "Indienne": null,
  "Indonésienne": null,
  "Iranienne": null,
  "Iraquienne": null,
  "Irlandaise": null,
  "Islandaise": null,
  "Israélienne": null,
  "Italienne": null,
  "Jamaïquaine": null,
  "Japonaise": null,
  "Jordanienne": null,
  "Kazakhe": null,
  "Kényane": null,
  "Kirghize": null,
  "Kiribatienne": null,
  "Koweïtienne": null,
  "Laotienne": null,
  "Lesothane": null,
  "Lettone": null,
  "Libanaise": null,
  "Libérienne": null,
  "Libyenne": null,
  "Liechtensteinoise": null,
  "Lituanienne": null,
  "Luxembourgeoise": null,
  "Malgache": null,
  "Malaisienne": null,
  "Malawienne": null,
  "Maldivienne": null,
  "Malienne": null,
  "Maltaise": null,
  "Marocaine": null,
  "Marshallaise": null,
  "Mauricienne": null,
  "Mauritanienne": null,
  "Mexicaine": null,
  "Micronésienne": null,
  "Moldave": null,
  "Monégasque": null,
  "Mongole": null,
  "Mozambicaine": null,
  "Namibienne": null,
  "Nauruane": null,
  "Népalaise": null,
  "Nicaraguayenne": null,
  "Nigérienne": null,
  "Nigériane": null,
  "Norvégienne": null,
  "Néo-Zélandaise": null,
  "Omanaise": null,
  "Ougandaise": null,
  "Ouzbèke": null,
  "Pakistanaise": null,
  "Panaméenne": null,
  "Papouane-Néo-Guinéenne": null,
  "Paraguayenne": null,
  "Néerlandaise": null,
  "Péruvienne": null,
  "Philippine": null,
  "Polonaise": null,
  "Portugaise": null,
  "Qatarienne": null,
  "Roumaine": null,
  "Britannique": null,
  "Russe": null,
  "Rwandaise": null,
  "Kittitienne": null,
  "Névicienne": null,
  "Saint-Lucienne": null,
  "Saint-Marinaise": null,
  "Saint-Vincentaise et Grenadine": null,
  "Salomonaise": null,
  "Salvadorienne": null,
  "Samoane": null,
  "Santoméenne": null,
  "Sénégalaise": null,
  "Seychelloise": null,
  "Sierra-Léonaise": null,
  "Singapourienne": null,
  "Slovaque": null,
  "Slovène": null,
  "Somalienne": null,
  "Soudanaise": null,
  "Sri-Lankaise": null,
  "Suédoise": null,
  "Suisse": null,
  "Surinamaise": null,
  "Swazie": null,
  "Syrienne": null,
  "Tadjike": null,
  "Tanzanienne": null,
  "Tchadienne": null,
  "Tchèque": null,
  "Thaïlandaise": null,
  "Togolaise": null,
  "Tonguienne": null,
  "Trinidadienne": null,
  "Tunisienne": null,
  "Turkmène": null,
  "Turque": null,
  "Tuvaluane": null,
  "Ukrainienne": null,
  "Uruguayenne": null,
  "Vanuatuane": null,
  "Vénézuélienne": null,
  "Vietnamienne": null,
  "Yéménite": null,
  "Yougoslave": null,
  "Zaïroise": null,
  "Zambienne": null,
  "Zimbabwéenne": null
}

var datepickerConfigWithMaxDate = { 
  format: 'dd/mm/yyyy',
  firstDay: 1, 
  showClearBtn: true,
  yearRange: 20,
  maxDate: new Date(),
  i18n: {
    cancel: 'Annuler',
    clear: 'Effacer',
    months: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
    monthsShort: ['Janv', 'Févr', 'Mars', 'Avril', 'Mai', 'Juin', 'Juil', 'Août', 'Sept', 'Oct', 'Nov', 'Déc'],
    weekdays: ['Dimanche','Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
    weekdaysShort: ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
    weekdaysAbbrev: ['D','L', 'M', 'M', 'J', 'V', 'S']
  }
}

var datepickerConfigWithMinDate = { 
  format: 'dd/mm/yyyy',
  firstDay: 1, 
  showClearBtn: true,
  yearRange: 20,
  minDate: new Date(),
  i18n: {
    cancel: 'Annuler',
    clear: 'Effacer',
    months: ['Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'],
    monthsShort: ['Janv', 'Févr', 'Mars', 'Avril', 'Mai', 'Juin', 'Juil', 'Août', 'Sept', 'Oct', 'Nov', 'Déc'],
    weekdays: ['Dimanche','Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'],
    weekdaysShort: ['Dim', 'Lun', 'Mar', 'Mer', 'Jeu', 'Ven', 'Sam'],
    weekdaysAbbrev: ['D','L', 'M', 'M', 'J', 'V', 'S']
  }
}

var nbEnfants = 0;

var newBeneficiaire = {}

function getInfoCheckDate(checkbox, fieldDate){
  var info = {
    check: getValueFromCheckBox(checkbox),
    date: getValueFromField(fieldDate)
  };
  return info;
}

function getInfoCheckDateText(checkbox, fieldDate, fieldText){
  var info = {
    obtenu: getValueFromCheckBox(checkbox),
    date: getValueFromField(fieldDate),
    info: getValueFromField(fieldText)
  };
  return info;
}

function getValueFromField(field) {
  return $('#'+field)[0].value;
}

function getValueFromCheckBox(checkbox) {
  return $('#'+checkbox).prop('checked');
}

function setNewBeneficiaire() {

  /* Inscription */
  var inscriptionObj = {
    inscripteur: getValueFromField('inscritPar'),
    dateInscription: getValueFromField('inscriLe')
  };
  
  /* Infos personnelles */
  var infosPersosObj = {
    identite: {
      prenom: getValueFromField('prenom'),
      nom: getValueFromField('nom'),
      genre: getGenre(),
      dateNaissance: getValueFromField('dateNaissance'),
      nomJeuneFille: getValueFromField('nomJF'),
      nationalite: getValueFromField('nationalite'),
      paysNaissance: getValueFromField('paysNaissance')
    },
    coordonnees: {
      adresse: getValueFromField('adresse'),
      codePostal: getValueFromField('codePostal'),
      ville: getValueFromField('ville'),
      mail: getValueFromField('mail'),
      numTel: getValueFromField('numTel')
    },
    etudes: {
      comprendFR: getValueFromCheckBox('comprendFR'),
      aLeBac: getValueFromCheckBox('aLeBac'),
      etudesSup: getValueFromField('etudesSup')
    }
  };

  /* Situation familiale */
  var situationFamilialeObj = {
    situation: getSituation(),
    dateSituation: getValueFromField('dateSituation'),
    conjoint: {
      prenom: getValueFromField('prenomConjoint'),
      nom: getValueFromField('nomConjoint'),
      dateNaissance: getValueFromField('dateNaissanceConjoint'),
      resideFrance: getValueFromCheckBox('checkResideFranceConjoint'),
      dateEntreeFrance: getValueFromField('dateEntreeFranceConjoint'),
      situation: getValueFromField('situationConjoint')
    },
    enfants: getEnfants()
  };

  /* Contacts */
  var contactsObj = {
    avocat: getValueFromField('telAvocat'),
    assistanteSociale: getValueFromField('telAssistanteSociale'),
    association: getValueFromField('telAssociation'),
    orientePar: getValueFromField('orientePar')
  };

  /* Entrée en France */
  var vieFranceObj = {
    entree: {
      dateEntreeFrance: getValueFromField('dateEntreeFrance'),
    },
    moyens: {
      visa: getInfoCheckDate('visa', 'dateValiditeVisa'),
      passeport: getInfoCheckDate('passeport', 'dateValiditePasseport')
    },
    titreSejour: {
      carteSejour: getInfoCheckDateText('carteSejour', 'dateCarteSejour', 'mentionCarteSejour'),
      carteResident: getInfoCheckDateText('carteResident', 'dateCarteResident', 'mentionCarteResident'),
      ressortissantEU: getInfoCheckDateText('ressortissantEU', 'dateRessortissantEU', 'paysRessortissantEU')
    },
    protectionInternationale: {
      refugie: getInfoCheckDate('refugie', 'dateValiditeRefugie'),
      protectionSubsidiaire: getInfoCheckDate('protectionSubsidiaire', 'dateValiditeProtectionSubsidiaire') 
    }
  };

  /* Démarches  Administratives */
  var demAdminObj = {
    demandeAsile: {
      procAcceleree: getInfoCheckDate('procNormale', 'derConvProcNormale'),
      procNormale: getInfoCheckDate('procAcceleree', 'derConvpProcAcceleree'),
      procDublin: getInfoCheckDate('procDublin', 'derConvProcDublin')
    },
    OFPRA: {
      lettreEnregistrement: getValueFromField('OFPRADateLettreEnr'),
      convocation: getValueFromField('OFPRADateConvoc'),
      reponse: getReponse('isAccOFPRA', 'isRefOFPRA'),
      dateReponse: getValueFromField('OFPRADateRep'),
      reexamen: getValueFromField('OFPRADateReexam')
    },
    CNDA: {
      avocat: getValueFromField('CNDAAvocat'),
      lettreEnregistrement: getValueFromField('CNDADateLettreEnr'),
      convocation: getValueFromField('CNDADateConvoc'),
      reponse: getReponse('isAccCNDA', 'isRefCNDA'),
      dateReponse: getValueFromField('CNDADateRep')
    },
    OQTF: {
      convocation: getValueFromField('OQTFDateConvoc'),
      reponse: getReponse('isAccOQTF', 'isRefOQTF'),
      dateReponse: getValueFromField('OQTFDateRep'),
      convocationAppel: getValueFromField('OQTFDateConvoc2'),
      reponseAppel: getReponse('isAccOQTF2', 'isRefOQTF2', true),
      dateReponseAppel: getValueFromField('OQTFDateRep2'),
    }
  }

  /* Cotisation */
  var cotisationObj = {
    payee: getValueFromCheckBox('payee'),
    montant: getMontant(),
    motif: getValueFromField('raisonPasCotise')
  };

  newBeneficiaire = {
    inscription: inscriptionObj,
    infosPersos: infosPersosObj,
    situationFamiliale: situationFamilialeObj,
    contacts: contactsObj,
    vieEnFrance: vieFranceObj,
    demAdmin: demAdminObj,
    cotisation: cotisationObj
  }

  setRecapitulatif();
}

function boolToString(bool){
  if(bool){
    return "Oui";
  } else {
    return "Non";
  }
}

function setRecapitulatif(){
  /* Inscription */
  $('#recInscritPar').html(newBeneficiaire.inscription.inscripteur);
  $('#recInscriLe').html(newBeneficiaire.inscription.dateInscription);

  /* Informations personnelles */
  $('#recPrenom').html(newBeneficiaire.infosPersos.identite.prenom);
  $('#recNom').html(newBeneficiaire.infosPersos.identite.nom);
  $('#recNomJF').html(newBeneficiaire.infosPersos.identite.nomJeuneFille);
  $('#recGenre').html(newBeneficiaire.infosPersos.identite.genre);
  $('#recDateNaissance').html(newBeneficiaire.infosPersos.identite.dateNaissance);
  $('#recNationalite').html(newBeneficiaire.infosPersos.identite.nationalite);
  $('#recPaysNaissance').html(newBeneficiaire.infosPersos.identite.paysNaissance);
  $('#recAdresse').html(newBeneficiaire.infosPersos.coordonnees.adresse);
  $('#recCodePostal').html(newBeneficiaire.infosPersos.coordonnees.codePostal);
  $('#recVille').html(newBeneficiaire.infosPersos.coordonnees.ville);
  $('#recMail').html(newBeneficiaire.infosPersos.coordonnees.mail);
  $('#recNumTel').html(newBeneficiaire.infosPersos.coordonnees.numTel);
  $('#recComprendFR').html(boolToString(newBeneficiaire.infosPersos.etudes.comprendFR));
  $('#recALeBac').html(boolToString(newBeneficiaire.infosPersos.etudes.aLeBac));
  $('#recEtudesSup').html(newBeneficiaire.infosPersos.etudes.etudesSup);

  /* Situation familiale */
  $('#recSituation').html(newBeneficiaire.situationFamiliale.situation);
  $('#recDateSituation').html(newBeneficiaire.situationFamiliale.dateSituation);
  $('#recPrenomConjoint').html(newBeneficiaire.situationFamiliale.conjoint.prenom);
  $('#recNomConjoint').html(newBeneficiaire.situationFamiliale.conjoint.nom);
  $('#recDateNaissanceConjoin').html(newBeneficiaire.situationFamiliale.conjoint.dateNaissance);
  $('#recResideFranceConjoint').html(boolToString(newBeneficiaire.situationFamiliale.conjoint.resideFrance));
  $('#recDateEntreeFranceConjoint').html(newBeneficiaire.situationFamiliale.conjoint.dateEntreeFrance);
  $('#recSituationConjoint').html(newBeneficiaire.situationFamiliale.conjoint.situation);

  /* Enfants */
  var html = ""
  if(newBeneficiaire.situationFamiliale.enfants.length > 0 && newBeneficiaire.situationFamiliale.enfants[0].prenom != ""){
    $(newBeneficiaire.situationFamiliale.enfants).each(function(index, enfant) {
      var nb = index + 1;
      html +=    "<li class='collection-header'><h5>Enfant " + nb + " </h5></li>\
                  <li class='collection-item'><div>Prénom                     <span class='secondary-content'>" + enfant.prenom + "</span></div></li>\
                  <li class='collection-item'><div>Nom                        <span class='secondary-content'>" + enfant.nom + "</span></div></li>\
                  <li class='collection-item'><div>Date de naissance          <span class='secondary-content'>" + enfant.dateNaissance + "</span></div></li>\
                  <li class='collection-item'><div>Réside en France           <span class='secondary-content'>" + boolToString(enfant.resideFrance) + "</span></div></li>\
                  <li class='collection-item'><div>Date d'entrée en France    <span class='secondary-content'>" + enfant.dateEntreeFrance + "</span></div></li>\
                  <li class='collection-item'><div>Nationalité                <span class='secondary-content'>" + enfant.nationalite + "</span></div></li>\
                  <li class='collection-item noBBord'><div>Pays de naissance          <span class='secondary-content'>" + enfant.paysNaissance + "</span></div></li>";
    });
  } else {
    html +=    "<li class='collection-header'><h5>Enfants</h5></li>\
                <li class='collection-item'><div>Pas d'enfants</div></li>";
  }
  $('#recEnfants').html(html);

  /* Contacts */
  $('#recTelAvocat').html(newBeneficiaire.contacts.avocat);
  $('#recTelAssistanteSociale').html(newBeneficiaire.contacts.assistanteSociale);
  $('#recTelAssociation').html(newBeneficiaire.contacts.association);
  $('#recOrientePar').html(newBeneficiaire.contacts.orientePar);

  /* Vie en France */
  $('#recDateEntreeFrance').html(newBeneficiaire.vieEnFrance.entree.dateEntreeFrance);
  $('#recAvecVisa').html(boolToString(newBeneficiaire.vieEnFrance.moyens.visa.check));
  $('#recDateValiditeVisa').html(newBeneficiaire.vieEnFrance.moyens.visa.date);
  $('#recAvecPasseport').html(boolToString(newBeneficiaire.vieEnFrance.moyens.passeport.check));
  $('#recDateValiditePasseport').html(newBeneficiaire.vieEnFrance.moyens.passeport.date);
  $('#recCarteSejour').html(boolToString(newBeneficiaire.vieEnFrance.titreSejour.carteSejour.check));
  $('#recMentionCarteSejour').html(newBeneficiaire.vieEnFrance.titreSejour.carteSejour.info);
  $('#recDateValiditeCarteSejour').html(newBeneficiaire.vieEnFrance.titreSejour.carteSejour.date);
  $('#recCarteResident').html(boolToString(newBeneficiaire.vieEnFrance.titreSejour.carteResident.check));
  $('#recMentionCarteResident').html(newBeneficiaire.vieEnFrance.titreSejour.carteResident.info);
  $('#recDateValiditeCarteResident').html(newBeneficiaire.vieEnFrance.titreSejour.carteResident.date);
  $('#recRessortissantEU').html(boolToString(newBeneficiaire.vieEnFrance.titreSejour.ressortissantEU.check));
  $('#recPaysRessortissantEU').html(newBeneficiaire.vieEnFrance.titreSejour.ressortissantEU.info);
  $('#recDateValiditeRessortissantEU').html(newBeneficiaire.vieEnFrance.titreSejour.ressortissantEU.date);
  $('#recRefugie').html(boolToString(newBeneficiaire.vieEnFrance.protectionInternationale.refugie.check));
  $('#recDateValiditeRefugie').html(newBeneficiaire.vieEnFrance.protectionInternationale.refugie.date);
  $('#recProtecSub').html(boolToString(newBeneficiaire.vieEnFrance.protectionInternationale.protectionSubsidiaire.check));
  $('#recDateValiditeProtecSub').html(newBeneficiaire.vieEnFrance.protectionInternationale.protectionSubsidiaire.date);

  /* Démarches administrative */
  $('#recProcNormale').html(boolToString(newBeneficiaire.demAdmin.demandeAsile.procAcceleree.check));
  $('#recDerConvProcNormale').html(newBeneficiaire.demAdmin.demandeAsile.procAcceleree.date);
  $('#recProcAcceleree').html(boolToString(newBeneficiaire.demAdmin.demandeAsile.procNormale.check));
  $('#recDerConvProcAccélérée').html(newBeneficiaire.demAdmin.demandeAsile.procNormale.date);
  $('#recProcDublin').html(boolToString(newBeneficiaire.demAdmin.demandeAsile.procDublin.check));
  $('#recDerConvProcDublin').html(newBeneficiaire.demAdmin.demandeAsile.procDublin.date);
  $('#recOFPRADateLettreEnr').html(newBeneficiaire.demAdmin.OFPRA.lettreEnregistrement);
  $('#recOFPRADateConvoc').html(newBeneficiaire.demAdmin.OFPRA.convocation);
  $('#recOFPRARep').html(newBeneficiaire.demAdmin.OFPRA.reponse);
  $('#recOFPRADateRep').html(newBeneficiaire.demAdmin.OFPRA.dateReponse);
  $('#recOFPRADateReexam').html(newBeneficiaire.demAdmin.OFPRA.reexamen);
  $('#recCNDAAvocat').html(newBeneficiaire.demAdmin.CNDA.avocat);
  $('#recCNDADateLettreEnr').html(newBeneficiaire.demAdmin.CNDA.lettreEnregistrement);
  $('#recCNDADateConvoc').html(newBeneficiaire.demAdmin.CNDA.convocation);
  $('#recCNDARep').html(newBeneficiaire.demAdmin.CNDA.reponse);
  $('#recCNDADateRep').html(newBeneficiaire.demAdmin.CNDA.dateReponse);
  $('#recOQTFDateConvoc').html(newBeneficiaire.demAdmin.OQTF.convocation);
  $('#recOQTFRep').html(newBeneficiaire.demAdmin.OQTF.reponse);
  $('#recOQTFDateRep').html(newBeneficiaire.demAdmin.OQTF.dateReponse);
  $('#recOQTFDateConvoc2').html(newBeneficiaire.demAdmin.OQTF.convocationApel);
  $('#recOQTFRep2').html(newBeneficiaire.demAdmin.OQTF.reponseAppel);
  $('#recOQTFDateRep2').html(newBeneficiaire.demAdmin.OQTF.dateReponseAppel);

  /* Cotisation */
  $('#recPayee').html(boolToString(newBeneficiaire.cotisation.payee));
  $('#recMontant').html(newBeneficiaire.cotisation.montant + " €");
  $('#recRaisonPasCotise').html(newBeneficiaire.cotisation.motif);

}

function getMontant() {
  var sit = parseInt(getValueFromField('montanCotisation'));
  var int = 0;

  switch (sit) {
    case 0:
      int = 0;
      break;
    case 1:
      int = 5;
      break;
    case 2:
      int = 10;
      break;
    case 3:
      int = 20;
      break;
  }

  return int;
}

function getSituation() {
  var sit = parseInt(getValueFromField('situation'));
  var text = "";

  switch (sit) {
    case 0:
      text = "Célibataire";
      break;
    case 1:
      text = "Marié.e";
      break;
    case 2:
      text = "Pacsé.e";
      break;
    case 3:
      text = "Concubin.e";
      break;
    case 4:
      text = "Veuf.ve";
      break;
  }

  return text;
}

function getGenre() {
  if (getValueFromCheckBox('isHomme')) {
    return 'H';
  } else {
    return 'F';
  }
}

function getReponse(responseYesField, responseNoField, isOQTF = false) {
  var ok = 'Acceptée';
  var ko = 'Refusée';
  if(isOQTF) {
    ok = 'Confirmation';
    ko = 'Annulation';
  }
  if (getValueFromCheckBox(responseYesField)) {
    return ok;
  } else if(getValueFromCheckBox(responseNoField)) {
    return ko;
  } else {
    return '';
  }
}

function getEnfants() {
  var res = [];

  for(var i = 0; i <= nbEnfants ; i++) {
    var idStr = "enfant" + i;
    var enfantCourant = {
      prenom: getValueFromField(idStr+' #prenomEnfant'),
      nom: getValueFromField(idStr+' #nomEnfant'),
      dateNaissance: getValueFromField(idStr+' #dateNaissanceEnfant'),
      resideFrance: getValueFromCheckBox(idStr+ ' #checkResideFranceEnfant'),
      dateEntreeFrance: getValueFromField(idStr+' #dateEntreeFranceEnfant'),
      nationalite: getValueFromField(idStr+' #nationaliteEnfant'),
      paysNaissance: getValueFromField(idStr+' #paysNaissanceEnfant')
    };
    res[i] = enfantCourant;
  }

  return res;

}

/* clonage de la div enfant */
$('#duplicateEnfant').click(function(){

  /* Création du clone */
  var clone = $('#enfant0').clone(true);

  /* Gestion de l'id */
  var idClone =  "enfant"+ ++nbEnfants
  clone.attr('id', idClone);

  /* Couleur de fond */
  if (nbEnfants % 2 != 0) {
    clone.css('background-color', 'rgb(196, 229, 255)');
  }

  $('#enfant0').parent().append(clone);

  /* Initialisation du datepicker */
  $('#'+idClone+' input.datepicker').datepicker(datepickerConfigWithMaxDate);

  /* Initialisation du champ auto-complete "Pays de naissance" */
  $('#'+idClone+' input.autocomplete.pays-naissance').autocomplete({ minLength: 2, data: listePays });

  /* Initialisation du champ auto-complete "Nationalite" */
  $('#'+idClone+' input.autocomplete.nationalite').autocomplete({ minLength: 2, data: listeNationalites });
  
})

$('.form .stages label').click(function() {
  // on doit attendre la fin de la transition (3s)
  setTimeout(function(){
    var radioButtons = $('.form > input:radio');
    var checkedButton = radioButtons.delay(20000).filter(':checked');
    var selectedIndex = radioButtons.index(checkedButton);

    selectedIndex = selectedIndex + 1;

    if (selectedIndex == 6) {
      $('button.btn-suivant').html('Valider');
    } else {
      $('button.btn-suivant').html('étape suivante');
    }
    if (selectedIndex == 1) {
      $('button.btn-precedent').hide();
    } else {
      $('button.btn-precedent').show();
    }
  }, 305);

});

$('.form button.btn-suivant').click(function() {
  var radioButtons = $('.form > input:radio');
  var selectedIndex = radioButtons.index(radioButtons.filter(':checked'));

  selectedIndex = selectedIndex + 2;

  $('.form > input[type="radio"]:nth-of-type(' + selectedIndex + ')').prop('checked', true);

  $('button.btn-precedent').show();

  if (selectedIndex >= 6) {
    $('button.btn-suivant').html('Valider');
  } else {
    $('button.btn-suivant').html('étape suivante');
  }

  if(selectedIndex == 7){
    setNewBeneficiaire();
    $('#modal1').modal('open');
  }
  
});

$('.form button.btn-precedent').click(function() {
  var radioButtons = $('.form > input:radio');
  var selectedIndex = radioButtons.index(radioButtons.filter(':checked'));

  selectedIndex = selectedIndex;

  $('.form > input[type="radio"]:nth-of-type(' + selectedIndex + ')').prop('checked', true);

  $('button.btn-suivant').show();
  $('button.btn-suivant').html('étape suivante');

  if (selectedIndex == 1) {
    $('button.btn-precedent').hide();
  } else {
    $('button.btn-precedent').show();
  }
});


// Fonction qui se déclanche au clic sur l'un des radio bouton du genre
$('input[name=genre]').click(function() {

  if($('input[name=genre]:checked').attr('id') == "isFemme") {
    $("#nomJF").removeAttr('disabled');
  } else {
    $("#nomJF").attr('disabled',"disabled");
  }

})

// Fonction qui se déclanche au clic sur l'une des situations
$('#situation').change(function() {

  if($('#situation')[0].value == "0" || $('#situation')[0].value == "4") {

    $("#dateSituation").attr('disabled',"disabled");

    $("#prenomConjoint").attr('disabled',"disabled");
    $("#nomConjoint").attr('disabled',"disabled");

    $("#dateNaissanceConjoint").attr('disabled',"disabled");
    $("#checkResideFranceConjoint").attr('disabled',"disabled");
    $("#dateEntreeFranceConjoint").attr('disabled',"disabled");

    $("#situationConjoint").attr('disabled',"disabled");
    
  } else {
    $("#dateSituation").removeAttr('disabled');

    $("#prenomConjoint").removeAttr('disabled');
    $("#nomConjoint").removeAttr('disabled');

    $("#dateNaissanceConjoint").removeAttr('disabled');
    $("#checkResideFranceConjoint").removeAttr('disabled');
    $("#dateEntreeFranceConjoint").removeAttr('disabled');

    $("#situationConjoint").removeAttr('disabled');
  }

})

function disabledField( check, fieldToDesactivate) {
  if (check.prop('checked')) {
    fieldToDesactivate.removeAttr('disabled');
  } else {
    fieldToDesactivate.attr('disabled',"disabled");
  }
}

$('#visa').click(function() {
  disabledField($(this), $('#dateValiditeVisa'));
})

$('#passeport').click(function() {
  disabledField($(this), $('#dateValiditePasseport'));
})

$('#carteSejour').click(function() {
  disabledField($(this), $('#mentionCarteSejour'));
  disabledField($(this), $('#dateCarteSejour'));
})

$('#carteResident').click(function() {
  disabledField($(this), $('#mentionCarteResident'));
  disabledField($(this), $('#dateCarteResident'));
})

$('#ressortissantEU').click(function() {
  disabledField($(this), $('#paysRessortissantEU'));
  disabledField($(this), $('#dateRessortissantEU'));
})

$('#refugie').click(function() {
  disabledField($(this), $('#dateValiditeRefugie'));
})

$('#protectionSubsidiaire').click(function() {
  disabledField($(this), $('#dateValiditeProtectionSubsidiaire'));
})

$('#procNormale').click(function() {
  disabledField($(this), $('#derConvProcNormale'));
})

$('#procAcceleree').click(function() {
  disabledField($(this), $('#derConvpProcAcceleree'));
})

$('#procDublin').click(function() {
  disabledField($(this), $('#derConvProcDublin'));
})

$('#payee').click(function() {
  var selectMontant = $("#montanCotisation").prevAll()[2];

  if ($(this).prop('checked')) {
    selectMontant.removeAttribute('disabled');
    $("#raisonPasCotise").attr('disabled',"disabled");
  } else {
    selectMontant.setAttribute('disabled','disabled');
    $('#raisonPasCotise').removeAttr('disabled');
  }

})

$('#pasPayee').click(function() {
  var selectMontant = $("#montanCotisation").prevAll()[2];

  if ($(this).prop('checked')) {
    $('#raisonPasCotise').removeAttr('disabled');
    selectMontant.setAttribute('disabled','disabled');
  } else {
    $("#raisonPasCotise").attr('disabled',"disabled");
    selectMontant.removeAttribute('disabled');
  }

})

// Fonction qui se déclanche au clic sur la résidence de l'enfant en France
$('.resideFranceEnfant input').change(function() {

  var length =  $(this).length;

  for( var i = 0; i < length; i++){
    var idEnfant =  $(this)[0].parentNode.parentNode.parentNode.parentNode.id;
    if($(this)[0].checked) {
      $("#"+idEnfant+" #dateEntreeFranceEnfant").removeAttr('disabled');
    } else {
      $("#"+idEnfant+" #dateEntreeFranceEnfant").attr('disabled',"disabled");
    }
  }

})

// Fonction qui se déclanche au clic sur la résidence du conjoint en France
$('.resideFranceConjoint input').change(function() {

    if($(this)[0].checked) {
      $("#dateEntreeFranceConjoint").removeAttr('disabled');
    } else {
      $("#dateEntreeFranceConjoint").attr('disabled',"disabled");
    }
  
})


$('#validerFormulaire').click(function(){
  $.post( '/inscireBeneficiaire', 
          newBeneficiaire, 
          function(){ 
            sessionStorage.setItem("InscriptionStatus", true);
            window.location.href = '/logged';
          }
  );
})

$(document).ready(function(){

  $('#today').html((new Date()).getFullYear());
  
  $('select').formSelect();

  $('button.btn-precedent').hide();

  /* Initialisation du datepicker */
  $('.datepicker').datepicker(datepickerConfigWithMaxDate);
  $('#dateValiditeTitre.datepicker').datepicker(datepickerConfigWithMinDate);
  $('#dateValiditePasseport.datepicker').datepicker(datepickerConfigWithMinDate);
  $('#dateValiditeVisa.datepicker').datepicker(datepickerConfigWithMinDate);
  $('#dateCarteSejour.datepicker').datepicker(datepickerConfigWithMinDate);
  $('#dateCarteResident.datepicker').datepicker(datepickerConfigWithMinDate);
  $('#dateRessortissantEU.datepicker').datepicker(datepickerConfigWithMinDate);
  $('#dateValiditeRefugie.datepicker').datepicker(datepickerConfigWithMinDate);
  $('#dateValiditeProtectionSubsidiaire.datepicker').datepicker(datepickerConfigWithMinDate);
  
  /* Initialisation du champ auto-complete "Pays de naissance" */
  $('input.autocomplete.pays-naissance').autocomplete({ minLength: 2, data: listePays });
  $('input.autocomplete.pays-ressortissant').autocomplete({ minLength: 2, data: listePaysEU });

  /* Initialisation du champ auto-complete "Nationalite" */
  $('input.autocomplete.nationalite').autocomplete({ minLength: 2, data: listeNationalites });

  /* Initialisation de la modale de confirmation */
  $('#modal1').modal();
});
